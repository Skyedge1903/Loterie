<!doctype html>
<html class="no-js" lang="fr">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Recherche" href="../search.html" /><link rel="prev" title="8. ERC721" href="erc721.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2021.09.22"/>
        <title>9. Truffle - Documentation PR: Ethereum</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=150e365fa939648e89c22f6d7d13c72a1657915a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Documentation PR: Ethereum </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Documentation PR: Ethereum </span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Recherche name="q" aria-label="Recherche">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../meta/build.html">1. Build cette documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blockchain/introduction.html">2. Blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blockchain/ethereum.html">3. Ethereum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blockchain/evm.html">4. EVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">5. Solidity</a></li>
<li class="toctree-l1"><a class="reference internal" href="safemath.html">6. safemath</a></li>
<li class="toctree-l1"><a class="reference internal" href="erc20.html">7. ERC20</a></li>
<li class="toctree-l1"><a class="reference internal" href="erc721.html">8. ERC721</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">9. Truffle</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="truffle">
<h1><span class="section-number">9. </span>Truffle<a class="headerlink" href="#truffle" title="Lien permanent vers ce titre">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">9.1. </span>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Truffle est un framework dédié au développement, au test et à la simulation local d’applications (smart contracts) conçues pour la machine virtuelle d’Ethereum.
Ce logiciel simplifie donc la vie des développeurs avec de nombreux outils et piplines.
Une foi le dévellopement terminé, truffle permetra également de déployer l’application sur la blockchaine test d’Ethereum ou en conditions réels sur la blockchaine principal.</p>
<p>Truffle intègre notamment la liste de fonctionnalités suivantes :</p>
<ul class="simple">
<li><p>Compilation, liaison, déploiement et gestion binaire des contrats intelligents intégrés.</p></li>
<li><p>Tests automatisés des contrats pour un développement rapide.</p></li>
<li><p>Un cadre de déploiement et de migration extensible et scriptable.</p></li>
<li><p>Gestion de réseau pour le déploiement sur un nombre illimité de réseaux publics et privés.</p></li>
<li><p>Gestion des paquets avec EthPM et NPM, en utilisant le standard ERC190.</p></li>
<li><p>Console interactive pour une communication directe avec le contrat.</p></li>
<li><p>Pipeline de construction configurable avec support pour une intégration étroite.</p></li>
<li><p>Exécuteur de scripts externe qui exécute les scripts dans un environnement Truffle.</p></li>
</ul>
<p>Source : <a href="https://www.trufflesuite.com/docs/truffle/overview">trufflesuite.com</a></p>
</section>
<section id="test">
<h2><span class="section-number">9.2. </span>Test<a class="headerlink" href="#test" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les tests s’éxecute sur un contrat solidity, il faut d’abord importer le contrat</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">myContract</span> <span class="o">=</span> <span class="nx">artifact</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">'./MyContract.sol'</span><span class="p">);</span>
</pre></div>
</div>
<p>Cet objet <code class="docutils literal notranslate"><span class="pre">myContract</span></code> correspond à une forme non-deployée du code. La première étape est donc de le déployer. La fonction <code class="docutils literal notranslate"><span class="pre">contract</span></code> permet de regrouper tous les tests d’un contrat. On passe dans la fonction lambda un appel vers <code class="docutils literal notranslate"><span class="pre">before</span></code> qui nous permet d’éxecuter du code avant tous les autres tests qui sont déclarer avec la méthode <code class="docutils literal notranslate"><span class="pre">it</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">contract</span><span class="p">(</span><span class="s1">'MyContract'</span><span class="p">,</span> <span class="nx">accounts</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nx">accounts</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
    
    <span class="nx">before</span><span class="p">(</span><span class="s1">'deploy contract'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">contract</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">myContract</span><span class="p">.</span><span class="nx">deployed</span><span class="p">()</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">'should have an owner'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">current_owner</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getOwner</span><span class="p">({</span><span class="kr">from</span> <span class="o">:</span> <span class="nx">accounts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="p">});</span>
        <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">current_owner</span><span class="p">,</span> <span class="nx">owner</span><span class="p">,</span> <span class="s2">"The owner isn't the person who deployed the contract"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>On peut remarquer qu’il est nécessaire de préciser de quel compte un appel provient par example l’appel vers geOwner prend <code class="docutils literal notranslate"><span class="pre">{from</span> <span class="pre">:</span> <span class="pre">accounts[0]}</span></code> en argument alors que get owner n’a pas de paramètres :</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">getOwner</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>On peut aussi tester les méthodes « payable » en passer une quantité de wei à la méthode en question.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s1">'should accept deposits'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">eth</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toWei</span><span class="p">(</span><span class="s2">"0.001"</span><span class="p">,</span> <span class="s1">'ether'</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span><span class="nx">eth</span><span class="p">,</span> <span class="p">{</span><span class="kr">from</span><span class="o">:</span> <span class="nx">accounts</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">eth</span><span class="p">});</span>
    <span class="kd">let</span> <span class="nx">amount</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">({</span><span class="kr">from</span><span class="o">:</span> <span class="nx">accounts</span><span class="p">[</span><span class="mf">0</span><span class="p">]})</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">amount</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">toBN</span><span class="p">(</span><span class="nx">eth</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Les méthodes « payable » attendent une quantité en <code class="docutils literal notranslate"><span class="pre">wei</span></code>. Pour faciliter cela web3 fourni des fonctions qui permettent des conversions sans pertes de <code class="docutils literal notranslate"><span class="pre">eth</span></code> vers <code class="docutils literal notranslate"><span class="pre">wei</span></code> et inversement. De la même manière que <code class="docutils literal notranslate"><span class="pre">getOwner</span></code>, l’appel de <code class="docutils literal notranslate"><span class="pre">deposit</span></code> prend deux arguments alors qu’il a une seul paramètres:</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Sauf que dans ce cas ci l”<code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">literal</span></code> attends un <code class="docutils literal notranslate"><span class="pre">value</span></code> avec le nombre de wei. Une fois les frais traitées <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> est  automatiquement attribuée au contrat si rien n’en ai fait. C’est pourquoi deposit ne fait rien d’autre que vérifier que <code class="docutils literal notranslate"><span class="pre">msg.value</span> <span class="pre">==</span> <span class="pre">amount</span></code>.</p>
<p>Le compte utilisé ici est fourni par truffle mais pour une <em>vraie</em> application web3 le compte serait un wallet connecté comme metamask.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="erc721.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title"><span class="section-number">8. </span>ERC721</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169;  |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>. |
            <a class="muted-link" href="../_sources/solidity/truffle.md.txt"
               rel="nofollow">
              Montrer le code source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contenu
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">9. Truffle</a><ul>
<li><a class="reference internal" href="#introduction">9.1. Introduction</a></li>
<li><a class="reference internal" href="#test">9.2. Test</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/main.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>